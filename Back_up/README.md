# Домашнее задание к занятию "Резервное копирование баз данных" - `Хамуро Илья`

### Задание 1
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

### Ответ на задание 1
1.1. Восстановление данных в полном объёме за предыдущий день
В этом случае наиболее целесообразно использовать полное резервное копирование (Full backup).

Полная копия базы создаётся ежедневно (например, ночью).

При поломке можно быстро развернуть копию и получить состояние базы «на вчера».

Плюсы: простота, надёжность.

Минусы: занимает много места и времени.

1.2. Восстановление данных за час до поломки
Здесь потребуется более частое копирование. Возможные варианты:

Инкрементное резервное копирование (сохраняются только изменения с момента последнего бэкапа). Можно комбинировать с ежедневным полным бэкапом.

Дифференциальное копирование (сохраняются изменения с момента последнего полного бэкапа).

Использование журналов транзакций (transaction logs) — в СУБД (например, PostgreSQL или MS SQL) можно настроить «точку во времени» (Point-in-Time Recovery, PITR). Это позволяет восстановиться до конкретного момента (например, за час до сбоя).

1.3. Моментальное переключение на рабочую или починенную базу*
Такое возможно при использовании технологий репликации и кластеризации:

Master-Slave репликация — данные синхронно или асинхронно копируются с основной базы на резервную.

Failover-кластер — при отказе основной базы автоматически происходит переключение на резервный узел.

High Availability (HA) решения: Patroni (для PostgreSQL), AlwaysOn (MS SQL), Oracle RAC, Percona XtraDB Cluster (MySQL).
Это позволяет минимизировать простой и работать без потери данных практически в реальном времени.

### Задание 2
PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.

### Ответ на задание 2

В PostgreSQL для резервного копирования и восстановления используются утилиты pg_dump и pg_restore.

Создание резервной копии (дампа):

```
  pg_dump -U username -d dbname -F c -f /backup/dbname.backup
```

Где:

-U username — имя пользователя PostgreSQL;

-d dbname — имя базы данных;

-F c — формат «custom», который можно потом использовать с pg_restore;

-f /backup/dbname.backup — путь к файлу резервной копии.

Восстановление базы данных из резервной копии:

```
  pg_restore -U username -d dbname -c /backup/dbname.backup
```

Где:

-c — очистка (drop) объектов перед восстановлением;

-d dbname — база, в которую восстанавливаем;

/backup/dbname.backup — файл резервной копии.

2.1. Автоматизация процесса*

Да, автоматизация возможна и часто используется:

Скрипты (bash, PowerShell):

Написать скрипт, который запускает pg_dump по расписанию.

Добавить дату в имя файла (например, dbname_2025-09-06.backup).

Хранить несколько последних бэкапов, старые удалять.

Планировщики заданий:

В Linux — cron для запуска скрипта (например, каждый день в 02:00).

В Windows — «Планировщик заданий».

### Задание 3
MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.

### Ответ на задание 3
3.1. Пример команды инкрементного резервного копирования

В MySQL для инкрементных бэкапов используется инструмент mysqlbackup (утилита из MySQL Enterprise Backup). Он позволяет сохранять только изменения с момента последнего полного бэкапа.

 Полный бэкап (первый шаг):
```
mysqlbackup --user=root --password=pass \
  --backup-dir=/backup/full \
  backup
```

 Инкрементный бэкап (с момента последнего полного):
```
mysqlbackup --user=root --password=pass \
  --incremental --incremental-base=dir:/backup/full \
  --backup-dir=/backup/inc1 \
  backup
```

 Восстановление (объединение полного + инкрементных):
```
mysqlbackup --backup-dir=/backup/full apply-log --incremental-backup-dir=/backup/inc1
mysqlbackup --backup-dir=/backup/full copy-back
```

 Если MySQL Community Edition (без Enterprise Backup), то можно использовать бинарные логи (binary logs):

Делаем полный дамп (mysqldump).

Включаем бинарные логи (log_bin в my.cnf).

Восстанавливаем полный дамп + применяем логи (mysqlbinlog) до нужного момента времени.
Это будет аналог инкрементного бэкапа.


Использование реплики (slave/replica) может быть полезнее, чем простое резервное копирование, в случаях:

 Высокая доступность (HA): если основной сервер выходит из строя, можно быстро переключить нагрузку на реплику (минимальный простой).

 Разгрузка основной базы: реплику можно использовать для отчётов, аналитики, сложных SELECT-запросов, чтобы не нагружать «боевую» базу.

 Быстрое восстановление: не нужно ждать восстановления из бэкапа, данные уже есть на реплике.

 Гибкость: можно настроить несколько реплик — для географического распределения, тестов или балансировки.
